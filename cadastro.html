<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>NeoRastro — Cadastro</title>

  <!-- ✅ Segurança e HTTPS -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' data:;
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self' 'unsafe-inline';
    connect-src 'self' https://neorastro.cloud;
    base-uri 'self';
    form-action 'self';
    frame-ancestors 'none';
    upgrade-insecure-requests;
  ">
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />

  <!-- ✅ Importar estilo global -->
  <link rel="stylesheet" href="estilo.css" />
</head>
<body class="pagina--autenticacao">
  <div class="sobreposicao">
    <main>
      <header>
        <h1>NeoRastro</h1>
        <p>Rastreie seus veículos com segurança e tecnologia.</p>
      </header>

      <section class="secao-formulario cartao-escuro" aria-labelledby="titulo-cadastro">
        <h2 id="titulo-cadastro">Crie sua Conta</h2>
        <div id="mensagem-cadastro" class="mensagem" role="status" aria-live="polite"></div>

        <form id="formulario-cadastro" autocomplete="on" novalidate>
          <input id="campo-nome" name="nome" type="text" placeholder="Nome completo" required minlength="3" />
          <input id="campo-email" name="email" type="email" placeholder="E-mail" required />

          <div class="linha">
            <input id="campo-telefone" name="telefone" type="tel" placeholder="Telefone (com DDD)" required />
            <input id="campo-empresa" name="empresa" type="text" placeholder="Empresa (opcional)" />
          </div>

          <div class="campo-senha">
            <input id="campo-senha" name="senha" type="password" placeholder="Crie uma senha" required minlength="8" />
            <button type="button" class="botao-alternar-senha" aria-label="Mostrar senha" aria-controls="campo-senha">👁️</button>
          </div>

          <div class="campo-senha">
            <input id="campo-confirmar" name="confirmar" type="password" placeholder="Confirme a senha" required minlength="8" />
            <button type="button" class="botao-alternar-senha" aria-label="Mostrar senha" aria-controls="campo-confirmar">👁️</button>
          </div>

          <label class="lembrar-dispositivo">
            <input id="campo-aceite" name="aceite" type="checkbox" required />
            <span>Concordo com os <a href="#">Termos</a> e a <a href="#">Política de Privacidade</a>.</span>
          </label>

          <button id="botao-cadastro" type="submit" disabled>Criar conta</button>
        </form>

        <div class="links">
          <a href="login.html">Já tem conta? Entrar</a>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Alternar visibilidade da senha
    document.querySelectorAll(".botao-alternar-senha").forEach(botao => {
      botao.addEventListener("click", () => {
        const campo = document.getElementById(botao.getAttribute("aria-controls"));
        if (!campo) return;
        const visivel = campo.type === "text";
        campo.type = visivel ? "password" : "text";
        botao.textContent = visivel ? "👁️" : "🙈";
      });
    });

    // Envio do formulário
    const form = document.getElementById("formulario-cadastro");
    const msg = document.getElementById("mensagem-cadastro");
    const botao = document.getElementById("botao-cadastro");

    form.addEventListener("input", () => botao.disabled = !form.checkValidity());

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      msg.textContent = "⏳ Enviando dados...";
      msg.className = "mensagem";

      const dados = Object.fromEntries(new FormData(form).entries());

      if (dados.senha !== dados.confirmar) {
        msg.textContent = "❌ As senhas não coincidem.";
        msg.className = "mensagem erro";
        return;
      }

      try {
        const resposta = await fetch("https://neorastro.cloud/cadastro", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(dados),
        });

        const resultado = await resposta.json();
        if (resposta.ok) {
          msg.textContent = "✅ Cadastro realizado com sucesso! Redirecionando...";
          msg.className = "mensagem sucesso";
          setTimeout(() => window.location.href = "login.html", 1500);
        } else {
          msg.textContent = "❌ " + (resultado.mensagem || "Erro ao cadastrar.");
          msg.className = "mensagem erro";
        }
      } catch {
        msg.textContent = "⚠️ Erro ao conectar com o servidor.";
        msg.className = "mensagem erro";
      }
    });
  </script>
</body>
</html>






