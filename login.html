<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#1d4ed8" />
  <title>NeoRastro ‚Äî Login</title>

  <!-- ‚úÖ CSS principal -->
  <link rel="stylesheet" href="estilo.css" />

  <!-- ‚úÖ Permitir comunica√ß√£o segura com a API da VPS -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' data:;
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self' 'unsafe-inline';
    connect-src 'self' https://api.neorastro.cloud;
    base-uri 'self';
    form-action 'self';
    frame-ancestors 'none';
    upgrade-insecure-requests;
  ">

  <style>
    .so-leitor { position:absolute; left:-10000px; width:1px; height:1px; overflow:hidden; }
    .mensagem { display:block; padding:10px; border-radius:10px; font-size:.95rem }
    .mensagem:empty { display:none }
    .mensagem.erro { background:#fee2e2; color:#7f1d1d }
    .mensagem.sucesso { background:#dcfce7; color:#14532d }
    .campo-senha { position:relative }
    .botao-alternar-senha { position:absolute; right:10px; top:50%; transform:translateY(-50%); background:none; border:0; color:#93c5fd; cursor:pointer; font-size:1.05rem }

    .nome-empresa {
      font-size: 2rem;
      font-weight: 800;
      text-align: center;
      margin-bottom: 10px;
      color: #1d4ed8;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
    }

    .titulo-login {
      font-size: 1.3rem;
      text-align: center;
      margin-bottom: 20px;
      color: #22c55e;
      font-weight: 600;
    }

    .linha-login {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 1rem;
      gap: 1rem;
    }
    .lembrar-dispositivo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: .9rem;
      color: #e5e7eb;
    }
    .lembrar-dispositivo input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: #2563eb;
    }
    #botao-entrar {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border-radius: 8px;
      font-weight: 600;
    }
  </style>
</head>
<body class="pagina--autenticacao">

  <div class="sobreposicao">
    <main class="container" style="display:grid;place-items:center;min-height:80dvh">
      <section class="secao-formulario cartao-escuro" aria-labelledby="titulo-login">

        <h1 class="nome-empresa">NeoRastro</h1>
        <h2 id="titulo-login" class="titulo-login">Fa√ßa seu Login</h2>

        <div id="mensagem-login" class="mensagem" role="status" aria-live="polite"></div>

        <!-- ‚úÖ Corrigido: rota direta para o backend -->
        <form id="formulario-entrada" method="post" action="https://api.neorastro.cloud/login" autocomplete="on" novalidate>
          <label class="so-leitor" for="campo-email">E-mail</label>
          <input id="campo-email" name="email" type="email" placeholder="Seu e-mail"
                 inputmode="email" autocomplete="email" autocapitalize="off" spellcheck="false" required />

          <div class="campo-senha">
            <label class="so-leitor" for="campo-senha">Senha</label>
            <input id="campo-senha" name="senha" type="password" placeholder="Sua senha"
                   autocomplete="current-password" required />
            <button type="button" class="botao-alternar-senha" aria-label="Mostrar senha"
                    aria-controls="campo-senha" aria-pressed="false">üëÅÔ∏è</button>
          </div>

          <div class="linha-login">
            <label class="lembrar-dispositivo">
              <input id="campo-lembrar" name="lembrar" type="checkbox" />
              <span>Lembrar de mim neste dispositivo</span>
            </label>
            <button id="botao-entrar" type="submit" disabled>Entrar</button>
          </div>
        </form>

        <div class="links" style="margin-top:.75rem">
          <a href="recuperar.html" rel="nofollow">Esqueci minha senha</a>
          <a href="cadastro.html">Criar conta</a>
        </div>
      </section>
    </main>
  </div>

  <noscript>
    <div style="max-width:480px;margin:16px auto;color:#fecaca;text-align:center">
      O JavaScript est√° desativado. Ative-o para fazer login.
    </div>
  </noscript>

  <script>
    "use strict";

    const API_BASE = "https://api.neorastro.cloud"; // ‚úÖ padronizado

    // Alternar visibilidade da senha
    function ligarAlternarSenha() {
      const botao = document.querySelector(".botao-alternar-senha");
      if (!botao) return;
      const alvoId = botao.getAttribute("aria-controls");
      const campo = document.getElementById(alvoId);
      if (!campo) return;

      botao.addEventListener("click", () => {
        const visivel = campo.type === "text";
        campo.type = visivel ? "password" : "text";
        botao.setAttribute("aria-pressed", String(!visivel));
        botao.setAttribute("aria-label", visivel ? "Mostrar senha" : "Ocultar senha");
      });
    }

    function iniciar() {
      const formulario = document.getElementById("formulario-entrada");
      const botao = document.getElementById("botao-entrar");
      const mensagem = document.getElementById("mensagem-login");
      const email = document.getElementById("campo-email");
      const senha = document.getElementById("campo-senha");

      const atualizarBotao = () => {
        botao.disabled = !(formulario.checkValidity() && email.value && senha.value);
      };
      formulario.addEventListener("input", atualizarBotao);
      formulario.addEventListener("change", atualizarBotao);

      formulario.addEventListener("submit", async (e) => {
        e.preventDefault();
        mensagem.textContent = "";
        mensagem.classList.remove("erro", "sucesso");

        try {
          botao.disabled = true;
          botao.dataset.label = botao.textContent;
          botao.textContent = "Entrando‚Ä¶";

          const dados = {
            email: email.value.trim(),
            senha: senha.value,
            lembrar: document.getElementById("campo-lembrar").checked,
          };

          const resposta = await fetch(`${API_BASE}/login`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Accept": "application/json",
            },
            body: JSON.stringify(dados),
            mode: "cors",
          });

          if (!resposta.ok) {
            let mensagemErro = "‚ùå Credenciais inv√°lidas ou falha de rede.";
            try {
              const err = await resposta.json();
              if (err && (err.mensagem || err.erro)) mensagemErro = err.mensagem || err.erro;
            } catch (_) {}
            throw new Error(mensagemErro);
          }

          const json = await resposta.json();
          localStorage.setItem("token", json.token || "");

          mensagem.textContent = "‚úÖ Login realizado! Redirecionando‚Ä¶";
          mensagem.classList.add("sucesso");
          setTimeout(() => { window.location.href = "painel.html"; }, 600);

        } catch (erro) {
          mensagem.textContent = erro?.message || "‚ùå N√£o foi poss√≠vel entrar. Tente novamente.";
          mensagem.classList.add("erro");
          botao.disabled = false;
          botao.textContent = botao.dataset.label || "Entrar";
        }
      });

      atualizarBotao();
      ligarAlternarSenha();
    }

    document.addEventListener("DOMContentLoaded", iniciar);
  </script>
</body>
</html>






