<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>NeoRastro ‚Äî Login</title>

  <!-- ‚úÖ Corrigido: caminho correto para GitHub Pages -->
  <link rel="stylesheet" href="estilo.css" />

  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' data:;
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self' 'unsafe-inline';
    connect-src 'self' https://api.neorastro.cloud;
    base-uri 'self';
    form-action 'self';
  ">
</head>
<body class="pagina--autenticacao">

  <div class="sobreposicao">
    <main class="container" style="display:grid;place-items:center;min-height:80dvh">
      <section class="secao-formulario cartao-escuro" aria-labelledby="titulo-login">
        
        <h1 class="nome-empresa">NeoRastro</h1>
        <h2 id="titulo-login" class="titulo-login">Fa√ßa seu Login</h2>

        <div id="mensagem-login" class="mensagem" role="status" aria-live="polite"></div>

        <form id="formulario-entrada" method="post" autocomplete="on" novalidate>
          <label class="so-leitor" for="campo-email">E-mail</label>
          <input id="campo-email" name="email" type="email" placeholder="Seu e-mail"
                 inputmode="email" autocomplete="email" autocapitalize="off" spellcheck="false" required />

          <div class="campo-senha">
            <label class="so-leitor" for="campo-senha">Senha</label>
            <input id="campo-senha" name="senha" type="password" placeholder="Sua senha"
                   autocomplete="current-password" required />
            <button type="button" class="botao-alternar-senha" aria-label="Mostrar senha"
                    aria-controls="campo-senha" aria-pressed="false">üëÅÔ∏è</button>
          </div>

          <div class="linha-login">
            <label class="lembrar-dispositivo">
              <input id="campo-lembrar" name="lembrar" type="checkbox" />
              <span>Lembrar de mim neste dispositivo</span>
            </label>
            <button id="botao-entrar" type="submit" disabled>Entrar</button>
          </div>
        </form>

        <div class="links" style="margin-top:.75rem">
          <a href="recuperar.html" rel="nofollow">Esqueci minha senha</a>
          <a href="cadastro.html">Criar conta</a>
        </div>
      </section>
    </main>
  </div>

  <noscript>
    <div style="max-width:480px;margin:16px auto;color:#fecaca;text-align:center">
      O JavaScript est√° desativado. Ative-o para fazer login.
    </div>
  </noscript>

  <script>
    function ligarAlternarSenha(){
      const botao = document.querySelector('.botao-alternar-senha');
      const campo = document.getElementById('campo-senha');
      if (!botao || !campo) return;
      botao.addEventListener('click', ()=>{
        const visivel = campo.type === 'text';
        campo.type = visivel ? 'password' : 'text';
        botao.textContent = visivel ? 'üëÅÔ∏è' : 'üôà';
        botao.setAttribute('aria-pressed', String(!visivel));
        botao.setAttribute('aria-label', visivel ? 'Mostrar senha' : 'Ocultar senha');
      });
    }

    function iniciar(){
      const formulario = document.getElementById('formulario-entrada');
      const botao = document.getElementById('botao-entrar');
      const mensagem = document.getElementById('mensagem-login');
      const email = document.getElementById('campo-email');
      const senha = document.getElementById('campo-senha');

      const atualizarBotao = ()=>{
        botao.disabled = !(email.value && senha.value);
      };
      formulario.addEventListener('input', atualizarBotao);

      formulario.addEventListener('submit', async (e)=>{
        e.preventDefault();
        mensagem.textContent = '';
        mensagem.classList.remove('erro','sucesso');
        botao.disabled = true;
        botao.dataset.label = botao.textContent;
        botao.textContent = 'Entrando‚Ä¶';

        try {
          // ‚úÖ Corrigido: backend via subdom√≠nio API
          const resposta = await fetch('https://api.neorastro.cloud/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: email.value.trim(),
              senha: senha.value.trim(),
              lembrar: document.getElementById('campo-lembrar').checked
            }),
          });

          const dados = await resposta.json();
          if (!resposta.ok) throw new Error(dados.erro || 'Credenciais inv√°lidas.');

          mensagem.textContent = '‚úÖ Login realizado! Redirecionando‚Ä¶';
          mensagem.classList.add('sucesso');
          setTimeout(()=> window.location.href = 'painel.html', 600);

        } catch (erro) {
          mensagem.textContent = '‚ùå ' + (erro.message || 'Erro ao conectar.');
          mensagem.classList.add('erro');
          botao.textContent = botao.dataset.label || 'Entrar';
          botao.disabled = false;
        }
      });

      atualizarBotao();
      ligarAlternarSenha();
    }

    document.addEventListener('DOMContentLoaded', iniciar);
  </script>
</body>
</html>






